<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="styles.css">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <!--script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script-->

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <title>LT Improved</title>
    </head>
    
    <body>
        <div class="container-fluid">
        
            <!-- Title bar -->
            <div class="row red">
                <img id="logo" src="img/logo_white.png" alt="Logo">
                <img id="close" src="img/close.png" alt="Fechar">
                <h4 id="title">LT Improved - Projeto 1</h4>
            </div>
            
            <!-- Tabs -->
            <div class="row red">
                <ul class="nav nav-tabs" id="tabs">
                    <li class="active"><a href="#">Página inicial</a></li>
                    <li><a href="#">Simulação</a></li>
                    <li><a href="#">Ferramentas</a></li>
                    <li><a href="#">Configurações</a></li>
                </ul>
            </div>
            
            <!-- Toolbar -->
            <div class="row gray">
                <ul class="list-inline" id="menu">
                    <li class="button"><a href="#">
                        <img src="img/blank-file.png">
                        <p>Novo</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/open-file.png">
                        <p>Abrir</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/save.png">
                        <p>Salvar</p>
                    </a></li>
                    
                    <li class="divider"></li>
                    
                    <li class="button"><a href="#">
                        <img src="img/play.png">
                        <p>Simular</p>
                    </a></li>
                    
                    <li class="divider"></li>
                    
                    <li class="button"><a href="#">
                        <img src="img/zoom-out.png">
                        <p>Reduzir</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/zoom-in.png">
                        <p>Ampliar</p>
                    </a></li>
                    
                    <li class="divider"></li>
                    
                    <li class="button"><a href="#">
                        <img src="img/copy.png" >
                        <p>Copiar</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/cut.png" >
                        <p>Recortar</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/paste.png" >
                        <p>Colar</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/delete.png" >
                        <p>Deletar</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/rotate.png" >
                        <p>Girar</p>
                    </a></li>
                    
                    <li class="divider"></li>
                    
                    <li class="button"><a href="#">
                        <img src="img/undo.png" >
                        <p>Desfazer</p>
                    </a></li>
                    <li class="button"><a href="#">
                        <img src="img/redo.png" >
                        <p>Refazer</p>
                    </a></li>
                    
                    <li class="divider"></li>
                    
                    <li class="button"><a href="#">
                        <img src="img/pencil.png" >
                        <p>Anotação</p>
                    </a></li>
                </ul>
            </div>
            
            <!-- Content -->
            <div class="row" id="content">
            
                <!-- Add component -->
                <div class="gray bar-left">
                
                    <p class="sidebar-title">Adicionar componente</p>
                    
                    <form>
                      <div class="input-group">
                        <input type="text" class="form-control" placeholder="Pesquisar (Ctrl + F)">
                        <div class="input-group-btn">
                          <button class="btn btn-default" type="submit">
                            <i class="glyphicon glyphicon-search"></i>
                          </button>
                        </div>
                      </div>
                    </form>
                
                    <div class="panel-group" id="accordion">
                      <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                          Componentes gerais
                        </div>
                        <div id="collapse1" class="panel-collapse collapse in">
                          <div class="panel-body">
                          <!-- style="transform: rotate(-90deg)" -->
                            <div class="component" data-type="capacitor">
                                <svg viewBox="0 0 48 16">
                                    <g stroke="#000" stroke-width="2" fill="none">
                                        <path d="m 0,8 21,0"/>
                                        <path d="m 21,0 0,16"/>
                                        <path d="m 27,0 0,16"/>
                                        <path d="m 27,8 21,0"/>
                                    </g>
                                </svg>
                              <span>Capacitor</span>
                            </div>
                            <div class="component" data-type="fonte">
                                <svg viewBox="0 0 56 48">
                                    <g stroke="#000" stroke-width="2" fill="none">
                                        <circle fill="#FFFFFF00" cy="24" cx="28" r="20"></circle>
                                        <path d="m 0,24 8,0"></path>
                                        <path d="m 48,24 8,0"></path>
                                        <path d="m 34,24 8,0"></path>
                                        <path d="m 38,20 0,8"></path>
                                        <path d="m 14,24 8,0"></path>
                                    </g>
                                </svg>
                              <span>Fonte de tensão</span>
                            </div>
                            <div class="component" data-type="indutor">
                                <svg viewBox="0 -2 48 8">
                                    <g stroke="#000" stroke-width="2" fill="none">
                                        <path d="m 0,4 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 l 8,0"/>
                                    </g>
                                </svg>
                              <span>Indutor</span>
                            </div>
                            <div class="component" data-type="resistor">
                                <svg viewBox="0 0 48 8">
                                    <g stroke="#000" stroke-width="2" fill="none">
                                        <path d="m 0,4 12,0 2,4 4,-8 4,8 4,-8 4,8 4,-8 2,4 12,0"/>
                                    </g>
                                </svg>
                              <span>Resistor</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                          ADC
                        </div>
                        <div id="collapse2" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                                <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                          Amplificadores
                        </div>
                        <div id="collapse3" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse4">
                          Comparadores
                        </div>
                        <div id="collapse4" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                     <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse5">
                          Componentes analógicos
                        </div>
                        <div id="collapse5" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                     <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse6">
                          Componentes digitais
                        </div>
                        <div id="collapse6" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse7">
                          Funções especiais
                        </div>
                        <div id="collapse7" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                     <div class="panel panel-default">
                        <div class="panel-heading" data-toggle="collapse" data-parent="#accordion" href="#collapse8">
                          Misc
                        </div>
                        <div id="collapse8" class="panel-collapse collapse">
                          <div class="panel-body">
                            <div class="component" data-type="exemplo">
                              <svg viewBox="0 7 48 34">
                                    <g stroke="#000" stroke-width="2" fill="#FFFFFF00">
                                        <path d="m 0,24 8,0"/>
                                        <path d="m 40,24 8,0"/>
                                        <circle cy="24" cx="24" r="16"/>
                                        <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"/>
                                        <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"/>
                                    </g>
                                </svg>
                              <span>Componente exemplo</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                </div>
                
                <!-- Canvas -->
                <div id="canvas" class="canvas">
                    <!-- Capacitor rotacionado -->
                    <svg viewBox="16 -16 16 48" class="model" data-type="capacitor" data-shift="14" style="position: absolute;height: 90px;top: 236px;left: 448px; display:none;">
                        <g stroke="#000" stroke-width="2" fill="none" transform="rotate(90, 24, 8)">
                            <path d="m 0,8 21,0"></path>
                            <path d="m 21,0 0,16"></path>
                            <path d="m 27,0 0,16"></path>
                            <path d="m 27,8 21,0"></path>
                        </g>
                    </svg>
                    <!-- Fonte rotacionada -->
                    <svg viewBox="-2 -4 44 56" class="model" data-type="fonte" data-shift="35" style="position: absolute; height: 90px; top: 251px; left: 542px; display:none;">
                        <g stroke="#000" stroke-width="2" fill="none" transform="rotate(90, 24, 20)">
                            <circle fill="#FFFFFF00" cy="24" cx="28" r="20"></circle>
                            <path d="m 0,24 8,0"></path>
                            <path d="m 48,24 8,0"></path>
                            <path d="m 18,20 0,8"></path>
                            <path d="m 38,20 0,8"></path>
                            <path d="m 14,24 8,0"></path>
                        </g>
                    </svg>
                    <!-- Indutor rotacionado -->
                    <svg viewBox="23 -20 8 48" class="model" data-type="indutor" data-shift="2" style="position: absolute; height: 90px; top: 318px; left: 479px; display:none;">
                        <g stroke="#000" stroke-width="2" fill="none" transform="rotate(90, 24, 4)">
                            <path d="m 0,4 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 a 3,4 0 0 1 8,0 l 8,0"></path>
                        </g>
                    </svg>
                    <!-- Resistor rotacionado -->
                    <svg viewBox="18 -20 12 48" class="model" data-type="resistor" data-shift="11" style="border-style: none; position: absolute; height: 90px; top: 343px; left: 331px; display:none;">
                        <g stroke="#000" stroke-width="2" fill="none" transform="rotate(90, 24, 4)">
                            <path d="m 0,4 12,0 2,4 4,-8 4,8 4,-8 4,8 4,-8 2,4 12,0"></path>
                        </g>
                    </svg>
                    <!-- Genérico rotacionado -->
                    <svg viewBox="7 0 34 48" class="model" data-type="exemplo" data-shift="31" style="border-style: none; position: absolute; height: 90px; top: 408px; left: 450px; display:none;">
                        <g stroke="#000" stroke-width="2" fill="#FFFFFF00" transform="rotate(90, 24, 24)">
                            <path d="m 0,24 8,0"></path>
                            <path d="m 40,24 8,0"></path>
                            <circle cy="24" cx="24" r="16"></circle>
                            <path transform="rotate(45, 24, 24)" d="m 24,8 0,32"></path>
                            <path transform="rotate(-45, 24, 24)" d="m 24,8 0,32"></path>
                        </g>
                    </svg>
                    <!-- Quadrado do terminal -->
                    <svg id="square" viewBox="0 0 16 16" style="position: absolute; height: 16px; top: 310px; left: 471px; display:none;">
                        <rect width="16" height="16" style="fill:none;stroke-width:6;stroke:rgb(0,193,24)" />
                    </svg>
                </div>
                
                <!-- Edit component -->
                <!--div class="gray bar-right">
                    <p class="sidebar-title">Editar componente</p>
                    <p class="sidebar-significant">Selecione um componente do canvas para editá-lo.</p>
                </div-->

                <div class="gray bar-right">
                    <p class="sidebar-title">Editar componente</p>
                    <div class="component-attribute">
                        <p>Nome</p>
                        <input type="text" class="form-control" placeholder="">
                    </div>
                    <div class="component-attribute">
                        <p>Valor</p>
                        <input type="text" class="form-control" placeholder="">
                    </div>
                </div>


            </div>
        </div>
        
        <script>                 
            
            //panel item
            var selected = null;
            //mouse component
            var element = null;
            
            function unselect() {
                if (selected) {
                    selected.find("svg").css("border-style", "none");
                    selected = null;
                }
                if (element) {
                    element.remove();
                    element = null;
                }
            }
            
            function getCanvasCorners() {
                let offset = $("#canvas").offset();
                return {
                    top: offset.top,
                    left: offset.left,
                    bottom: offset.top + $("#canvas").height(),
                    right: offset.left+ $("#canvas").width()
                }
            }
            
            let corners = getCanvasCorners();
            
            //pick the component
            $(document).on("click", ".component", function(){
                console.log($(this).attr('data-type'));
                unselect();
                selected = $(this);
                element = $(".model[data-type='" + selected.attr("data-type") + "']").clone().show();
                element.removeAttr("class");
                element.css("position", "absolute");
                //element.css("transform", "rotate(-90deg)");
                element.css('top', corners.top + (corners.bottom-corners.top)/2-50 + 'px');
                element.css('left', corners.left + 'px');
                $("#canvas").append(element);
                selected.find("svg").css("border-style", "dashed");
            });
            
            //carry the component
            $("#canvas").mousemove(function(e){
                if (selected &&
                        e.pageX >= corners.left && 
                        e.pageY >= corners.top && 
                        e.pageX <= corners.right && 
                        e.pageY <= corners.bottom) {
                    //console.log(e.pageX + ' ' + e.pageY,);
                    element.css('top', Math.min(e.pageY, corners.bottom-element.height()) + 'px');
                    element.css('left', Math.min(e.pageX, corners.right-element.width()) + 'px');
                }
            });
            
            //drop the component
            $("#canvas").click(function(){
                if (element) {
                    // fix element position
                    let offset = element.offset();
                    element.css('top', Math.round((offset.top - corners.top) / 15.0) * 15 + corners.top);
                    let shift = parseInt(element.attr('data-shift'));
                    element.css('left', Math.round((offset.left - corners.left + shift) / 15.0) * 15 + corners.left - shift);
                    
                    // add the terminal squares
                    //let square1 = $("#square").clone().show();
                    //square1.left
                    
                    element = null;
                    unselect();
                }
            });
            
            //set ESC to unselect everything
            $(document).keydown(function(e) {
                // escape key
                if (e.keyCode == 27) {
                    unselect();
                }
            });
            
        </script>
    </body>
    
</html>
